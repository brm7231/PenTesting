#!/bin/bash

# Check if passwords.txt exists, create if it doesn't
if [ ! -f passwords.txt ]; then
  echo "bandit0:bandit0" > passwords.txt
fi

if [ "$1" ]; then
  if [ "$1" = "-h" ]; then
    echo "Help: This script allows you to specify the starting bandit level as a number."
    echo "Usage: ./script.sh [bandit_level]"
    echo "Example: ./script.sh 3"
    exit 0
  elif [ "$1" -eq "$1" ] 2>/dev/null; then
    usernum="$1"
  else
    echo "Invalid parameter. Use '-h' for help."
    exit 1
  fi
else
  credentials=$(tail -n 1 passwords.txt)
  username=$(echo "$credentials" | cut -d ':' -f 1)
  usernum=$(echo "$username" | grep -oE '[0-9]+')
fi

while true; do
  credentials=$(grep "bandit$usernum" passwords.txt)
  username=$(echo "$credentials" | cut -d ':' -f 1)
  password=$(echo "$credentials" | cut -d ':' -f 2)

  sshpass -p "$password" ssh -p 2220 "$username"@bandit.labs.overthewire.org

  usernum=$((usernum+1))
  username="bandit$usernum"

  read -rp "Enter the password for $username (type 'quit' to end): " password

  if [ "$password" = "quit" ]; then
    echo "Script ended."
    break
  fi

  credentials="$username:$password"
  echo "$credentials" >> passwords.txt
done
